<html><head>
	<title>pinch-test</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<!-- Disable browser cache -->
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Cache-Control" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<!-- polyfill -->
	<script src="polyfill.min.js"></script>
	<!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
<h1>pinch-test.html</h1>
<hr />
<canvas id="image-screen" width="400" height="400" style="border: 3px solid black"></canvas>
<hr />
<p id="info"></p>
<script>
$(function(){
	var pinchDistance = 0;
	var scale = 1.0;
	var timerID;
	var tx0, ty0;
	var px = 0, py = 0;
	var s0;
	function redraw() {
		var canvas = $("#image-screen");
		var ctx = canvas[0].getContext('2d');
		ctx.fillStyle = "white";
		ctx.fillRect(0, 0, 400, 400);
		ctx.strokeStyle = "black";
		ctx.strokeRect(200 - 70 * scale / 2 + px, 200 - 70 * scale / 2 + py, 70 * scale, 70 * scale);
	}
	// タッチデバイスでタッチ開始した。
	document.getElementById("image-screen").addEventListener('touchstart', function(e){
		var t = e.touches;
		if (t.length > 1) {
			var w = Math.abs(t[1].pageX - t[0].pageX);
			var h = Math.abs(t[1].pageY - t[0].pageY);
			s0 = w * h;
		}
	}, {passive: false});
	// タッチデバイスでタッチ移動した。
	document.getElementById("image-screen").addEventListener('touchmove', function(e){
		e.preventDefault();
		var t = e.touches;
		if (t.length > 1) {
			var w = Math.abs(t[1].pageX - t[0].pageX);
			var h = Math.abs(t[1].pageY - t[0].pageY);
			var s1 = w * h;
			if (s0 + 80 < s1) {
				scale += 0.02 * scale;
			} else if (s0 + 20 < s1) {
				scale += 0.1 * scale;
			} else if (s0 > s1 + 80) {
				scale -= 0.02 * scale;
			} else if (s0 > s1 + 20) {
				scale -= 0.1 * scale;
			}
			s0 = s1;
			$("#info").text(s0);
			var x0 = t[0].pageX;
			var y0 = t[0].pageY;
			var x1 = t[1].pageX;
			var y1 = t[1].pageY;
			var ptx0 = (x0 + x1) / 2;
			var pty0 = (y0 + y1) / 2;
			if (tx0 === undefined || ty0 === undefined) {
				tx0 = ptx0;
				ty0 = pty0;
			} else {
				px += ptx0 - tx0;
				py += pty0 - ty0;
				tx0 = ptx0;
				ty0 = pty0;
			}
			redraw();
		}
	}, {passive: false});
	redraw();
});
</script>
</body></html>
