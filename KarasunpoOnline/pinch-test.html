<html><head>
	<title>pinch-test</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<!-- Disable browser cache -->
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Cache-Control" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<!-- polyfill -->
	<script src="polyfill.min.js"></script>
	<!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
<h1>pinch-test.html</h1>
<hr />
<canvas id="image-screen" width="400" height="400" style="border: 3px solid black"></canvas>
<script>
$(function(){
	var pinchDistance = 0;
	var scale = 1.0;
	var timerID;
	var tx0, ty0;
	var px = 0, py = 0;
	function redraw() {
		var canvas = $("#image-screen");
		var ctx = canvas[0].getContext('2d');
		ctx.fillStyle = "white";
		ctx.fillRect(0, 0, 400, 400);
		ctx.strokeStyle = "black";
		ctx.strokeRect(200 - 70 * scale / 2 + px, 200 - 70 * scale / 2 + py, 70 * scale, 70 * scale);
	}
	// タッチデバイスでタッチ移動した。
	document.getElementById("image-screen").addEventListener('touchmove', function(e){
		e.preventDefault();
		var t = e.changedTouches;
		if (t.length > 1) {
			var x0 = t[0].pageX;
			var y0 = t[0].pageY;
			var x1 = t[1].pageX;
			var y1 = t[1].pageY;
			var dx = x1 - x0, dy = y1 - y0;
			var distance = Math.sqrt(dx * dx + dy * dy);
			var ptx0 = (x0 + x1) / 2;
			var pty0 = (y0 + y1) / 2;
			if (tx0 === undefined || ty0 === undefined) {
				tx0 = ptx0;
				ty0 = pty0;
			} else {
				px += ptx0 - tx0;
				py += pty0 - ty0;
				tx0 = ptx0;
				ty0 = pty0;
			}
			clearTimeout(timerID);
			if (pinchDistance != 0) {
				scale = distance / pinchDistance;
				redraw();
				timerID = setTimeout(function(){
					pinchDistance = 0;
					tx0 = ty0 = undefined;
				}, 500);
			} else {
				pinchDistance = distance;
			}
			redraw();
		}
	}, {passive: false});
	redraw();
});
</script>
<hr />
</body></html>
